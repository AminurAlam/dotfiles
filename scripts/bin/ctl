#!/usr/bin/fish --no-config

switch $argv[1]
    case vol
        if [ -n "$argv[2]" ]
            wpctl set-volume @DEFAULT_AUDIO_SINK@ (math 2 x (printf $argv[2] | wc -c))%$(string sub -l1 -- $argv[2])
            notify-send -h string:x-canonical-private-synchronous:volume -t 500 "Volume: $(wpctl get-volume @DEFAULT_AUDIO_SINK@ | tr -dc [:digit:] | math)"
        else
            wpctl set-mute @DEFAULT_AUDIO_SINK@ toggle
            wpctl get-volume @DEFAULT_AUDIO_SINK@ | rg -q MUTED
            and notify-send -h string:x-canonical-private-synchronous:mute -t 500 "MUTED 󰸈"
            or notify-send -h string:x-canonical-private-synchronous:mute -t 500 "AUDIBLE 󰖀"
        end

    case mic
        wpctl set-mute @DEFAULT_AUDIO_SOURCE@ toggle
        wpctl get-volume @DEFAULT_AUDIO_SOURCE@ | rg -q MUTED
        and notify-send -h string:x-canonical-private-synchronous:mic -t 500 "MUTED "
        or notify-send -h string:x-canonical-private-synchronous:mic -t 500 "AUDIBLE "

    case lum
        brightnessctl s (math 2 x (printf $argv[2] | wc -c))%$(string sub -l1 -- $argv[2])
        notify-send -h string:x-canonical-private-synchronous:brightness -t 500 "Brightness: $(math -s0 (brightnessctl g) x 100 / (brightnessctl m))"

    case ss
        set filename Screenshot_(date +'%Y%m%d_%H%M%S')_grim.png

        if [ "$argv[2]" = full ]
            grim ~/Pictures/Screenshots/$filename && notify-send "$filename taken"
        else
            grim -g (slurp) ~/Pictures/Screenshots/$filename && notify-send "$filename taken"
        end

    case pow
        set current (powerprofilesctl get)
        if [ "$argv[2]" = up -a "$current" = balanced ]
            notify-send -h string:x-canonical-private-synchronous:power -t 500 "PERFORMANCE  "
            powerprofilesctl set performance
        else if [ "$argv[2]" = up -a "$current" = power-saver ] \
                || [ "$argv[2]" = down -a "$current" = performance ]
            notify-send -h string:x-canonical-private-synchronous:power -t 500 "BALANCED  "
            powerprofilesctl set balanced
        else if [ "$argv[2]" = down -a "$current" = balanced ]
            notify-send -h string:x-canonical-private-synchronous:power -t 500 "POWER-SAVER  "
            powerprofilesctl set power-saver
        end
    case lim
        set file /sys/bus/platform/drivers/ideapad_acpi/VPC2004:00/conservation_mode
        test -w $file && echo $(math bitxor 1,(cat $file)) >$file
        [ "$(cat $file)" = 1 ]
        and notify-send -h string:x-canonical-private-synchronous:limit -t 500 " BATTERY LIMITED"
        or notify-send -h string:x-canonical-private-synchronous:limit -t 500 " BATTERY UNLOCKED"
end
